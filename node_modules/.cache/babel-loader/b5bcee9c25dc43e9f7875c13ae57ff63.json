{"ast":null,"code":"import { observable } from 'mobx';\nimport Repository from './repository';\nconst {\n  ethereum\n} = window;\nconst Store = observable({\n  account: null,\n  stakingContract: null,\n  //SHIBA STAKING SMART CONTRACT\n  SBPContract: null,\n  // $SBP SMART CONTRACT\n  web3: null,\n  stakingInfo: {\n    TVL: '',\n    // total value locked\n    accountStakingTotal: 0,\n    // Your SBPS in Staking\n    totalExpectedReward: 0,\n    // Total Expected Reward\n    tier: '',\n    // Account Tier\n    SBPBalance: 0,\n    // Account $SBP Balance\n    allowance: 0\n  },\n  stakingPool: [],\n  //Staking Pools\n  stakeIDs: [],\n  // StakeIDs of Account\n  stakedPools: [],\n  //Staked Pool of Account\n  paneltyFee: 0,\n\n  // Panelty Fee\n  async fetchContract() {\n    try {\n      await Repository.fetchContract().then(res => {\n        if (res) {\n          const {\n            smartContract_SBP,\n            smartContract_staking,\n            web3\n          } = res;\n          this.stakingContract = smartContract_staking;\n          this.SBPContract = smartContract_SBP;\n          this.web3 = web3;\n        }\n      });\n      return true;\n    } catch (err) {// console.log('err: ', err);\n    }\n  },\n\n  async connectWallet() {\n    try {\n      await Repository.walletConnect().then(res => {\n        if (res) {\n          this.account = res;\n          this.fetchAccountInfo();\n        }\n      });\n      return {\n        result: true,\n        msg: 'Succeed Connect Wallet'\n      };\n    } catch (err) {\n      return {\n        result: false,\n        msg: err\n      };\n    }\n  },\n\n  addAccountListner(fetch) {\n    ethereum.on('accountsChanged', _ref => {\n      let [accounts] = _ref;\n      this.account = accounts;\n      this.stakeIDs = [];\n      this.stakedPools = [];\n      fetch();\n    });\n    ethereum.on('chainChanged', () => {\n      window.location.reload();\n    });\n  },\n\n  fetchAccountInfo() {\n    this.getAllowance();\n    this.getAccountStakingTotal();\n    this.getTotalExpectedReward();\n    this.getAccountTier();\n    this.getSBPBalance();\n    this.getStakeIds();\n    this.getTVL();\n  },\n\n  async getTVL() {\n    try {\n      await Repository.getTVL(this.stakingContract.methods).then(res => {\n        if (res) this.stakingInfo.TVL = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async ApproveMaxBalance() {\n    try {\n      await Repository.approveMaxBalance({\n        contract: this.SBPContract.methods,\n        stakingAddress: this.stakingContract._address,\n        account: this.account\n      });\n      this.getAllowance();\n      return {\n        result: true,\n        msg: 'Approval Success'\n      };\n    } catch (err) {\n      return {\n        result: false,\n        msg: 'Failed Approval'\n      };\n    }\n  },\n\n  async getAllowance() {\n    try {\n      await Repository.getAllowance({\n        contract: this.SBPContract.methods,\n        stakingAddress: this.stakingContract._address,\n        account: this.account\n      }).then(res => {\n        if (res) this.stakingInfo.allowance = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getAccountStakingTotal() {\n    try {\n      await Repository.getAccountStakingTotal({\n        contract: this.stakingContract.methods,\n        account: this.account\n      }).then(res => {\n        if (res) this.stakingInfo.accountStakingTotal = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getTotalExpectedReward() {\n    try {\n      await Repository.getTotalExpectedReward({\n        contract: this.stakingContract.methods,\n        account: this.account\n      }).then(res => {\n        if (res) this.stakingInfo.totalExpectedReward = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getAccountTier() {\n    try {\n      await Repository.getAccountTier({\n        contract: this.stakingContract.methods,\n        account: this.account\n      }).then(res => {\n        if (res) this.stakingInfo.tier = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getFees() {\n    try {\n      await Repository.getFees({\n        contract: this.SBPContract.methods\n      }).then(res => {\n        if (res) this.Fees = res;\n      });\n      return true;\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getSBPBalance() {\n    try {\n      await Repository.getSBPBalance({\n        contract: this.SBPContract.methods,\n        account: this.account\n      }).then(res => {\n        if (res) this.stakingInfo.SBPBalance = res;\n      });\n      return true;\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getPenaltyFee() {\n    try {\n      await Repository.getPenaltyFee({\n        contract: this.stakingContract.methods\n      }).then(res => {\n        if (res) this.paneltyFee = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getStakingPool() {\n    //storageID (풀 종류) 조회\n    try {\n      this.stakingPool = [];\n      await Repository.getStorageNumbers({\n        contract: this.stakingContract.methods\n      }).then(async res => {\n        if (res && res > 0) {\n          let poolInfo = [];\n\n          for (let i = 0; i < res; i++) {\n            let pool = await Repository.getPoolInfo({\n              contract: this.stakingContract.methods,\n              storageID: i + 1\n            });\n            poolInfo.push({\n              storageId: i + 1,\n              ...pool\n            });\n          }\n\n          this.stakingPool = poolInfo;\n        } // console.log('stakingPool: ', this.stakingPool);\n\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getStakeIds() {\n    //유저가 stakedid 목록 조회\n    try {\n      this.stakedPools = [];\n      await Repository.getStakeIds({\n        contract: this.stakingContract.methods,\n        account: this.account\n      }).then(async res => {\n        if (res && res.length > 0) {\n          this.stakeIDs = res;\n\n          for (let i = 0; i < res.length; i++) {\n            await this.getStakedPool(res[i]).then(res => {\n              if (res) this.stakedPools.push(res);\n            });\n          }\n\n          setTimeout(() => {}, 3000);\n        }\n      });\n    } catch (err) {}\n  },\n\n  async getStakedPool(stakeId) {\n    //staking 한 stakeid로 pool 검색\n    try {\n      const res = await Repository.getStakedPool({\n        contract: this.stakingContract.methods,\n        account: this.account,\n        stakeIds: stakeId\n      });\n      return { ...res,\n        stakingId: stakeId\n      };\n    } catch (err) {\n      console.log(err);\n    }\n  },\n\n  async stakeSBP(_ref2) {\n    let {\n      amount,\n      storageId\n    } = _ref2;\n\n    try {\n      await Repository.stakeSBP({\n        contract: this.stakingContract.methods,\n        amount: amount,\n        storageId: storageId,\n        account: this.account\n      });\n      return {\n        result: true,\n        msg: 'Succeed Staking SBP'\n      };\n    } catch (err) {\n      return {\n        result: false,\n        msg: 'Failed Staking SBP'\n      };\n    }\n  },\n\n  async unStakeSBP(stakedId) {\n    try {\n      await Repository.unStake({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account\n      });\n      return {\n        result: true,\n        msg: 'Succeed Claim Reward'\n      };\n    } catch (err) {\n      return {\n        result: false,\n        msg: 'Failed Claim Reward'\n      };\n    }\n  },\n\n  async earlyClaimSBP(stakedId) {\n    try {\n      await Repository.earlyClaimSBP({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account\n      });\n      return {\n        result: true,\n        msg: 'Succeed Early Claim Reward'\n      };\n    } catch (err) {\n      return {\n        result: false,\n        msg: 'Failed Claim Early Reward'\n      };\n    }\n  },\n\n  async getStakeStatus(stakedId) {\n    try {\n      return await Repository.getStakeStatus({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account\n      });\n    } catch (err) {//\n    }\n  },\n\n  async getExpectedPoolReward(stakedId) {\n    try {\n      return await Repository.getExpectedPoolReward({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account\n      });\n    } catch (err) {//\n    }\n  }\n\n});\nexport default Store;","map":{"version":3,"sources":["C:/Users/user/Desktop/shibapad_staking-main (2)/shibapad_staking-main/src/store/store.js"],"names":["observable","Repository","ethereum","window","Store","account","stakingContract","SBPContract","web3","stakingInfo","TVL","accountStakingTotal","totalExpectedReward","tier","SBPBalance","allowance","stakingPool","stakeIDs","stakedPools","paneltyFee","fetchContract","then","res","smartContract_SBP","smartContract_staking","err","connectWallet","walletConnect","fetchAccountInfo","result","msg","addAccountListner","fetch","on","accounts","location","reload","getAllowance","getAccountStakingTotal","getTotalExpectedReward","getAccountTier","getSBPBalance","getStakeIds","getTVL","methods","ApproveMaxBalance","approveMaxBalance","contract","stakingAddress","_address","getFees","Fees","getPenaltyFee","getStakingPool","getStorageNumbers","poolInfo","i","pool","getPoolInfo","storageID","push","storageId","length","getStakedPool","setTimeout","stakeId","stakeIds","stakingId","console","log","stakeSBP","amount","unStakeSBP","stakedId","unStake","earlyClaimSBP","getStakeStatus","getExpectedPoolReward"],"mappings":"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","sourcesContent":["import { observable } from 'mobx';\nimport Repository from './repository';\nconst { ethereum } = window;\nconst Store = observable({\n  account: null,\n  stakingContract: null, //SHIBA STAKING SMART CONTRACT\n  SBPContract: null, // $SBP SMART CONTRACT\n  web3: null,\n  stakingInfo: {\n    TVL: '', // total value locked\n    accountStakingTotal: 0, // Your SBPS in Staking\n    totalExpectedReward: 0, // Total Expected Reward\n    tier: '', // Account Tier\n    SBPBalance: 0, // Account $SBP Balance\n    allowance: 0,\n  },\n  stakingPool: [], //Staking Pools\n  stakeIDs: [], // StakeIDs of Account\n  stakedPools: [], //Staked Pool of Account\n  paneltyFee: 0, // Panelty Fee\n\n  async fetchContract() {\n    try {\n      await Repository.fetchContract().then(res => {\n        if (res) {\n          const { smartContract_SBP, smartContract_staking, web3 } = res;\n          this.stakingContract = smartContract_staking;\n          this.SBPContract = smartContract_SBP;\n          this.web3 = web3;\n        }\n      });\n      return true;\n    } catch (err) {\n      // console.log('err: ', err);\n    }\n  },\n  async connectWallet() {\n    try {\n      await Repository.walletConnect().then(res => {\n        if (res) {\n          this.account = res;\n          this.fetchAccountInfo();\n        }\n      });\n      return { result: true, msg: 'Succeed Connect Wallet' };\n    } catch (err) {\n      return { result: false, msg: err };\n    }\n  },\n  addAccountListner(fetch) {\n    ethereum.on('accountsChanged', ([accounts]) => {\n      this.account = accounts;\n      this.stakeIDs = [];\n      this.stakedPools = [];\n      fetch();\n    });\n    ethereum.on('chainChanged', () => {\n      window.location.reload();\n    });\n  },\n  fetchAccountInfo() {\n    this.getAllowance();\n    this.getAccountStakingTotal();\n    this.getTotalExpectedReward();\n    this.getAccountTier();\n    this.getSBPBalance();\n    this.getStakeIds();\n    this.getTVL();\n  },\n  async getTVL() {\n    try {\n      await Repository.getTVL(this.stakingContract.methods).then(res => {\n        if (res) this.stakingInfo.TVL = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async ApproveMaxBalance() {\n    try {\n      await Repository.approveMaxBalance({\n        contract: this.SBPContract.methods,\n        stakingAddress: this.stakingContract._address,\n        account: this.account,\n      });\n\n      this.getAllowance();\n      return { result: true, msg: 'Approval Success' };\n    } catch (err) {\n      return { result: false, msg: 'Failed Approval' };\n    }\n  },\n\n  async getAllowance() {\n    try {\n      await Repository.getAllowance({\n        contract: this.SBPContract.methods,\n        stakingAddress: this.stakingContract._address,\n        account: this.account,\n      }).then(res => {\n        if (res) this.stakingInfo.allowance = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async getAccountStakingTotal() {\n    try {\n      await Repository.getAccountStakingTotal({\n        contract: this.stakingContract.methods,\n        account: this.account,\n      }).then(res => {\n        if (res) this.stakingInfo.accountStakingTotal = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n\n  async getTotalExpectedReward() {\n    try {\n      await Repository.getTotalExpectedReward({\n        contract: this.stakingContract.methods,\n        account: this.account,\n      }).then(res => {\n        if (res) this.stakingInfo.totalExpectedReward = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async getAccountTier() {\n    try {\n      await Repository.getAccountTier({\n        contract: this.stakingContract.methods,\n        account: this.account,\n      }).then(res => {\n        if (res) this.stakingInfo.tier = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async getFees() {\n    try {\n      await Repository.getFees({\n        contract: this.SBPContract.methods,\n      }).then(res => {\n        if (res) this.Fees = res;\n      });\n      return true;\n    } catch (err) {\n      return err;\n    }\n  },\n  async getSBPBalance() {\n    try {\n      await Repository.getSBPBalance({\n        contract: this.SBPContract.methods,\n        account: this.account,\n      }).then(res => {\n        if (res) this.stakingInfo.SBPBalance = res;\n      });\n      return true;\n    } catch (err) {\n      return err;\n    }\n  },\n  async getPenaltyFee() {\n    try {\n      await Repository.getPenaltyFee({\n        contract: this.stakingContract.methods,\n      }).then(res => {\n        if (res) this.paneltyFee = res;\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async getStakingPool() {\n    //storageID (풀 종류) 조회\n    try {\n      this.stakingPool = [];\n      await Repository.getStorageNumbers({\n        contract: this.stakingContract.methods,\n      }).then(async res => {\n        if (res && res > 0) {\n          let poolInfo = [];\n          for (let i = 0; i < res; i++) {\n            let pool = await Repository.getPoolInfo({\n              contract: this.stakingContract.methods,\n              storageID: i + 1,\n            });\n            poolInfo.push({ storageId: i + 1, ...pool });\n          }\n          this.stakingPool = poolInfo;\n        }\n        // console.log('stakingPool: ', this.stakingPool);\n      });\n    } catch (err) {\n      return err;\n    }\n  },\n  async getStakeIds() {\n    //유저가 stakedid 목록 조회\n    try {\n      this.stakedPools = [];\n      await Repository.getStakeIds({\n        contract: this.stakingContract.methods,\n        account: this.account,\n      }).then(async res => {\n        if (res && res.length > 0) {\n          this.stakeIDs = res;\n          for (let i = 0; i < res.length; i++) {\n            await this.getStakedPool(res[i]).then(res => {\n              if (res) this.stakedPools.push(res);\n            });\n          }\n          setTimeout(() => {}, 3000);\n        }\n      });\n    } catch (err) {}\n  },\n  async getStakedPool(stakeId) {\n    //staking 한 stakeid로 pool 검색\n    try {\n      const res = await Repository.getStakedPool({\n        contract: this.stakingContract.methods,\n        account: this.account,\n        stakeIds: stakeId,\n      });\n      return { ...res, stakingId: stakeId };\n    } catch (err) {\n      console.log(err);\n    }\n  },\n  async stakeSBP({ amount, storageId }) {\n    try {\n      await Repository.stakeSBP({\n        contract: this.stakingContract.methods,\n        amount: amount,\n        storageId: storageId,\n        account: this.account,\n      });\n      return { result: true, msg: 'Succeed Staking SBP' };\n    } catch (err) {\n      return { result: false, msg: 'Failed Staking SBP' };\n    }\n  },\n  async unStakeSBP(stakedId) {\n    try {\n      await Repository.unStake({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n\n        account: this.account,\n      });\n      return { result: true, msg: 'Succeed Claim Reward' };\n    } catch (err) {\n      return { result: false, msg: 'Failed Claim Reward' };\n    }\n  },\n  async earlyClaimSBP(stakedId) {\n    try {\n      await Repository.earlyClaimSBP({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account,\n      });\n      return { result: true, msg: 'Succeed Early Claim Reward' };\n    } catch (err) {\n      return { result: false, msg: 'Failed Claim Early Reward' };\n    }\n  },\n  async getStakeStatus(stakedId) {\n    try {\n      return await Repository.getStakeStatus({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account,\n      });\n    } catch (err) {\n      //\n    }\n  },\n  async getExpectedPoolReward(stakedId) {\n    try {\n      return await Repository.getExpectedPoolReward({\n        contract: this.stakingContract.methods,\n        stakedId: stakedId,\n        account: this.account,\n      });\n    } catch (err) {\n      //\n    }\n  },\n});\n\nexport default Store;\n"]},"metadata":{},"sourceType":"module"}